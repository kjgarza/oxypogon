# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Oxypogon is a CrossFit Workout of the Day (WOD) viewer that uses GitHub Flat Data to scrape workouts from CrossFit MINS, then enhances them with OpenAI-generated explanations for beginners. The site is built with Eleventy (11ty) and includes pages for movements and hero workouts.

## Key Commands

```bash
# 11ty Development (Bun)
bun install              # Install dependencies
bun run dev              # Local dev server with watch
bun run build            # Production build to _site/

# Deno Web Scraping (unchanged)
deno task process        # Process workout file (requires OPENAI_API_KEY)
```

## Architecture

```
src/
├── _data/
│   ├── site.json         # Site metadata and author info
│   ├── movements.json    # 117 CrossFit movements
│   ├── heroes.json       # 22 hero workouts
│   └── workout.js        # Loader for outputs/workout_with_explanation.json
├── _includes/
│   ├── layouts/
│   │   └── base.njk      # Base HTML layout (Tailwind + daisyUI)
│   └── components/
│       ├── header.njk    # Site navigation
│       └── footer.njk    # Site footer
├── css/
│   ├── fonts.css         # Font pairings (Reddit Sans + Sora)
│   └── styles.css        # Custom styles
├── js/
│   └── theme.js          # Theme management (daisyUI themes)
├── index.njk             # Homepage (daily WOD)
├── movements/index.njk   # Movements library page
└── heroes/index.njk      # Hero workouts page

postprocess/              # Deno scripts for Flat Data workflow
├── process_workout.ts    # Main processing: scrape → parse → OpenAI → output
└── constants.ts          # AI prompt templates

outputs/                  # Generated by Deno pipeline, consumed by 11ty
├── workout_with_explanation.json
├── ai_explanation.txt
└── workout_explanation.md

.github/workflows/
├── scrape-workout.yml    # Flat Data cron (Sun, Mon, Wed, Fri 6 AM UTC)
└── build-deploy.yml      # 11ty build + GitHub Pages deploy
```

## Tech Stack

- **Static Site Generator**: Eleventy v3 with Nunjucks templates
- **Package Manager**: Bun
- **Frontend**: Tailwind CSS CDN + daisyUI v4
- **Scraping Runtime**: Deno (for Flat Data postprocessing)
- **AI**: OpenAI `gpt-4o-mini` for workout explanations
- **Hosting**: GitHub Pages

## Data Flow

1. **Scraping** (Deno): Flat Data fetches HTML from CrossFit MINS → `workout_page.html`
2. **Processing** (Deno): `process_workout.ts` extracts tokens, fetches workout via AJAX, calls OpenAI
3. **Output** (Deno): Results written to `outputs/` as JSON, TXT, and Markdown
4. **Build** (Bun/11ty): 11ty reads from `src/_data/` and `outputs/`, generates static HTML to `_site/`
5. **Deploy**: GitHub Actions pushes `_site/` to GitHub Pages

## Code Patterns

### 11ty Data Files
Data in `src/_data/` is automatically available in templates:
- `site.json` → `{{ site.title }}`
- `movements.json` → `{{ movements.movements }}`
- `heroes.json` → `{{ heroes.heroes }}`
- `workout.js` → `{{ workout.combined_content }}`

### Custom Filters
Defined in `.eleventy.js`:
- `formatDate` - Format ISO dates to readable strings
- `formatTimestamp` - Format timestamps with time
- `groupByCategory` - Group movements array by category
- `uniqueBranches` - Extract unique military branches from heroes
- `titleCase` - Convert snake_case to Title Case

### Deno Flat Data Helpers
```typescript
import { readTXT, writeJSON, writeTXT } from 'https://deno.land/x/flat@0.0.15/mod.ts';
```

## Environment Variables

- `OPENAI_API_KEY` – Required for AI explanations (GitHub secret)

## Pages

- `/` – Daily WOD with AI explanation
- `/movements/` – 117 movements grouped by category with filters
- `/heroes/` – 22 hero workouts filterable by military branch
